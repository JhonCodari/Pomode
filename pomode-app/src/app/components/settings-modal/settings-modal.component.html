<div class="modal-overlay" (click)="cancel()" role="dialog" aria-modal="true" aria-labelledby="settings-title">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <app-card [elevated]="true" [hasHeader]="true">
      <div card-header>
        <h3 id="settings-title"><span aria-hidden="true">‚öôÔ∏è</span> {{ 'SETTINGS.TITLE' | translate }}</h3>
      </div>

      <div class="settings-form">
        <!-- Se√ß√£o: Tempos -->
        <div class="settings-section">
          <h4 class="section-title">{{ 'SETTINGS.TIMES.SECTION' | translate }}</h4>

          <!-- Tempo de Foco -->
          <app-form-field
            fieldId="workTime"
            [label]="'SETTINGS.TIMES.WORK_TIME'"
            type="number"
            emoji="üçÖ"
            [(ngModel)]="workTime"
            [min]="limits.workTime.min"
            [max]="limits.workTime.max"
            [hint]="'SETTINGS.TIMES.BETWEEN' | translate: { min: limits.workTime.min, max: limits.workTime.max }"
          ></app-form-field>

          <!-- Pausa Curta -->
          <app-form-field
            fieldId="shortBreak"
            [label]="'SETTINGS.TIMES.SHORT_BREAK'"
            type="number"
            emoji="‚òï"
            [(ngModel)]="shortBreakTime"
            [min]="limits.shortBreakTime.min"
            [max]="limits.shortBreakTime.max"
            [hint]="'SETTINGS.TIMES.BETWEEN' | translate: { min: limits.shortBreakTime.min, max: limits.shortBreakTime.max }"
          ></app-form-field>

          <!-- Pausa Longa -->
          <app-form-field
            fieldId="longBreak"
            [label]="'SETTINGS.TIMES.LONG_BREAK'"
            type="number"
            emoji="üå¥"
            [(ngModel)]="longBreakTime"
            [min]="limits.longBreakTime.min"
            [max]="limits.longBreakTime.max"
            [hint]="'SETTINGS.TIMES.BETWEEN' | translate: { min: limits.longBreakTime.min, max: limits.longBreakTime.max }"
          ></app-form-field>

          <!-- Ciclos -->
          <app-form-field
            fieldId="cycles"
            [label]="'SETTINGS.TIMES.CYCLES_FOR_LONG_BREAK'"
            type="number"
            emoji="üîÑ"
            [(ngModel)]="cyclesBeforeLongBreak"
            [min]="limits.cyclesBeforeLongBreak.min"
            [max]="limits.cyclesBeforeLongBreak.max"
            [hint]="'SETTINGS.TIMES.BETWEEN' | translate: { min: limits.cyclesBeforeLongBreak.min, max: limits.cyclesBeforeLongBreak.max }"
          ></app-form-field>
        </div>

        <!-- Se√ß√£o: Som -->
        <div class="settings-section">
          <h4 class="section-title">{{ 'SETTINGS.SOUND.SECTION' | translate }}</h4>

          <!-- Toggle de Som -->
          <div class="form-group form-group-toggle">
            <label for="soundEnabled">
              <span aria-hidden="true">üîä</span> {{ 'SETTINGS.SOUND.ENABLED' | translate }}
            </label>
            <label class="toggle-switch">
              <input
                id="soundEnabled"
                type="checkbox"
                [(ngModel)]="soundEnabled"
              />
              <span class="toggle-slider"></span>
            </label>
          </div>

          <!-- Volume -->
          @if (soundEnabled) {
            <div class="form-group">
              <label for="soundVolume">
                <span aria-hidden="true">üéöÔ∏è</span> {{ 'SETTINGS.SOUND.VOLUME' | translate }} ({{ soundVolume }}%)
              </label>
              <div class="volume-control">
                <input
                  id="soundVolume"
                  type="range"
                  [(ngModel)]="soundVolume"
                  [min]="limits.soundVolume.min"
                  [max]="limits.soundVolume.max"
                  class="form-range"
                />
                <app-button
                  [variant]="'ghost'"
                  [size]="'sm'"
                  (click)="testSound()"
                  [title]="'SETTINGS.SOUND.TEST' | translate"
                >
                  <span aria-hidden="true">‚ñ∂</span> {{ 'SETTINGS.SOUND.TEST' | translate }}
                </app-button>
              </div>
            </div>
          }
        </div>

        <!-- Se√ß√£o: Notifica√ß√µes -->
        <div class="settings-section">
          <h4 class="section-title">{{ 'SETTINGS.NOTIFICATIONS.SECTION' | translate }}</h4>

          <!-- Toggle de Notifica√ß√µes -->
          <div class="form-group form-group-toggle">
            <label for="notificationsEnabled">
              <span aria-hidden="true">üîî</span> {{ 'SETTINGS.NOTIFICATIONS.ENABLED' | translate }}
            </label>
            <label class="toggle-switch">
              <input
                id="notificationsEnabled"
                type="checkbox"
                [(ngModel)]="notificationsEnabled"
                (change)="notificationsEnabled && requestNotificationPermission()"
              />
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>
      </div>

      <div class="modal-actions">
        <app-button
          [variant]="'ghost'"
          [size]="'md'"
          (click)="resetToDefault()"
        >
          {{ 'SETTINGS.ACTIONS.DEFAULT' | translate }}
        </app-button>

        <div class="action-buttons">
          <app-button
            [variant]="'outline'"
            [size]="'md'"
            (click)="cancel()"
          >
            {{ 'SETTINGS.ACTIONS.CANCEL' | translate }}
          </app-button>

          <app-button
            [variant]="'primary'"
            [size]="'md'"
            (click)="saveSettings()"
          >
            {{ 'SETTINGS.ACTIONS.SAVE' | translate }}
          </app-button>
        </div>
      </div>
    </app-card>
  </div>
</div>
